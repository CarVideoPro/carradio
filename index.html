<!DOCTYPE html>
<html lang="tr">
<head>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Car Video Pro Radyo</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  
  <style>
    :root {
        --player-height: 55px;
        --category-bar-height: 40px;
    }

    /* TEMA RENK DEƒûƒ∞≈ûKENLERƒ∞ */
    [data-theme='default'] { --bg-primary: linear-gradient(135deg, #232526 0%, #414345 100%); --bg-secondary: #232526; --bg-tertiary: #414345; --bg-hover: #5c5c5c; --border-color: #3366cc; --accent-color: #00c6ff; --accent-color-darker: #0072ff; --text-primary: #fff; --text-secondary: #b3c6ff; --favorite-color: #ffd700; }
    [data-theme='forest'] { --bg-primary: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); --bg-secondary: #11998e; --bg-tertiary: #38ef7d; --bg-hover: #56c596; --border-color: #38ef7d; --accent-color: #43e97b; --accent-color-darker: #38ef7d; --text-primary: #fff; --text-secondary: #d0ffd6; --favorite-color: #ffeb3b; }
    [data-theme='royal'] { --bg-primary: linear-gradient(135deg, #654ea3 0%, #eaafc8 100%); --bg-secondary: #654ea3; --bg-tertiary: #eaafc8; --bg-hover: #b983ff; --border-color: #eaafc8; --accent-color: #b983ff; --accent-color-darker: #654ea3; --text-primary: #fff; --text-secondary: #f3e5f5; --favorite-color: #fdd835; }
    [data-theme='sunset'] { --bg-primary: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%); --bg-secondary: #ff9966; --bg-tertiary: #ff5e62; --bg-hover: #ff7e5f; --border-color: #ff5e62; --accent-color: #ff7e5f; --accent-color-darker: #ff9966; --text-primary: #fff3e0; --text-secondary: #ffccbc; --favorite-color: #ffc107; }
    [data-theme='steel'] { --bg-primary: linear-gradient(135deg, #485563 0%, #29323c 100%); --bg-secondary: #485563; --bg-tertiary: #29323c; --bg-hover: #6e7f80; --border-color: #757575; --accent-color: #a8c0ff; --accent-color-darker: #485563; --text-primary: #f5f5f5; --text-secondary: #bdbdbd; --favorite-color: #f5f5f5; }
    [data-theme='yellow'] { --bg-primary: linear-gradient(135deg, #fffde7 0%, #fff176 100%); --bg-secondary: #fffde7; --bg-tertiary: #fff176; --bg-hover: #ffee58; --border-color: #fbc02d; --accent-color: #ffd600; --accent-color-darker: #ffb300; --text-primary: #795548; --text-secondary: #a1887f; --favorite-color: #ffeb3b; --icon-color: #000; --icon-shadow: 0 0 8px #ffb300; }

    * { box-sizing: border-box; }
    html, body {
        margin: 0; height: 100%; background: var(--bg-primary); font-family: 'Montserrat', 'Segoe UI', 'Arial Black', Arial, sans-serif; overflow: hidden;
        color: var(--text-primary);
        font-size: 15px;
        font-weight: 500;
    }
    
    #app {
      display: flex; flex-direction: column; height: 100%;
      padding-bottom: calc(var(--player-height) + var(--category-bar-height));
    }
    #main {
      display: flex; flex: 1; overflow: hidden;
    }
    
    #channels {
      flex: 0 0 260px;
      background: var(--bg-secondary);
      border-right: 2px solid var(--border-color);
      overflow-y: auto;
      padding: 8px;
      display: flex; flex-direction: column; gap: 6px;
    }
    
    /* --- ANA G√ñR√úN√úM ALANI --- */
    #previewArea {
        flex: 1; display: flex; flex-direction: column;
        justify-content: center; align-items: center;
        background: var(--bg-primary); overflow: hidden; position: relative;
    }

    #previewPlaceholder {
        padding: 20px; display: flex; flex-direction: column;
        align-items: center; justify-content: center; text-align: center;
        gap: 15px; color: #555; height: 100%; cursor: default; z-index: 1;
    }
    #previewPlaceholder h2 { font-size: 1.5em; }
    #previewPlaceholder p { font-size: 1em; }
    
    /* --- G√ñRSELLE≈ûTƒ∞Rƒ∞Cƒ∞ VE LOGO D√úZENƒ∞ --- */
    #visualizer-wrapper {
        display: none; /* M√ºzik √ßalƒ±nca flex olacak */
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0; left: 0;
        padding: 10px 0;
        z-index: 2;
    }
    
    /* Ekolayzer Satƒ±rlarƒ± */
    .analyzer-row { display: flex; justify-content: center; align-items: flex-end; height: 60px; width: 100%; gap: 5px; }
    .analyzer-row.top { transform: rotate(180deg); margin-bottom: 10px; }
    .analyzer-row.bottom { margin-top: 10px; }

    .analyzer-bar {
        width: 12px; background-color: var(--accent-color);
        border-radius: 3px;
        animation: analyzer-wave 0.8s infinite ease-in-out alternate;
    }

    /* Orta Satƒ±r: Butonlar ve Logo */
    #middle-controls-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px; /* Butonlar ve logo arasƒ± bo≈üluk */
        flex: 1; 
        width: 100%;
    }

    #main-logo-display {
        width: 240px; height: 240px; border-radius: 50%;
        object-fit: contain; background-color: rgba(255,255,255,0.05);
        border: 4px solid var(--bg-tertiary);
        box-shadow: 0 5px 25px rgba(0,0,0,0.3);
        flex-shrink: 0;
    }

    /* --- YUVARLAK VE B√úY√úK BUTONLAR --- */
    .mid-nav-btn {
        /* ≈ûekil ve Boyut */
        width: 75px; 
        height: 75px; 
        border-radius: 50%; /* Tam Daire */
        
        /* Renk ve Stil */
        background: rgba(0, 0, 0, 0.3); 
        border: 3px solid var(--accent-color); 
        color: var(--text-primary);
        
        /* Yazƒ±/ƒ∞kon */
        font-size: 32px;
        
        /* Hizalama */
        cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        
        /* Efektler */
        transition: all 0.2s cubic-bezier(.4,2,.3,.7);
        backdrop-filter: blur(6px);
        box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }
    
    /* OPTƒ∞K Hƒ∞ZALAMA D√úZELTMESƒ∞ */
    /* ƒ∞leri oku g√∂rsel olarak solda aƒüƒ±r basar, saƒüa itiyoruz */
    #next-btn { padding-left: 6px; } 
    /* Geri oku g√∂rsel olarak saƒüda aƒüƒ±r basar, sola itiyoruz */
    #prev-btn { padding-right: 4px; }

    .mid-nav-btn:hover {
        background: var(--accent-color);
        color: #000;
        transform: scale(1.15);
        box-shadow: 0 0 25px var(--accent-color);
        border-color: #fff;
    }
    
    .mid-nav-btn:active { transform: scale(0.95); }

    /* Oynatma Durumu */
    #previewArea.is-playing #previewPlaceholder { display: none; }
    #previewArea.is-playing #visualizer-wrapper { display: flex; }
    
    @keyframes analyzer-wave {
        0% { height: 10%; opacity: 0.5; }
        100% { height: 100%; opacity: 1; }
    }

    /* --- SAƒû Dƒ∞KEY KONTROL ALANI (ZOOM + TEMA) --- */
    #side-controls-container {
        position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
        display: flex; flex-direction: column; gap: 15px; z-index: 100;
        background: rgba(0, 0, 0, 0.3); padding: 15px 8px; border-radius: 30px;
        backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.1);
        align-items: center;
    }
    
    .zoom-btn {
        background-color: var(--bg-tertiary); color: var(--text-primary);
        border: 2px solid var(--border-color);
        width: 32px; height: 32px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; transition: 0.2s; font-weight: bold;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    .zoom-btn:hover { background-color: var(--accent-color); border-color: #fff; }
    .zoom-btn svg { width: 20px; height: 20px; fill: currentColor; }

    #theme-list {
        display: flex; flex-direction: column; gap: 10px;
    }
    
    .theme-swatch {
           width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid var(--border-color);
           box-shadow: 0 2px 5px rgba(0,0,0,0.3); transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
    }
    .theme-swatch:hover { transform: scale(1.3); }
    .theme-swatch.active { border-color: #fff; box-shadow: 0 0 10px var(--accent-color); transform: scale(1.2); }

    #audio-player { display: none; }
    
    /* GRUPLAR */
    #groups {
        position: fixed; bottom: var(--player-height); left: 0; width: 100%; height: var(--category-bar-height);
        background: var(--bg-secondary); border-top: 1px solid var(--border-color);
        display: flex; overflow-x: auto; z-index: 1000;
        scrollbar-width: thin; scrollbar-color: var(--accent-color) var(--bg-secondary);
    }
    #groups::-webkit-scrollbar { height: 6px; }
    #groups::-webkit-scrollbar-track { background: var(--bg-secondary); }
    #groups::-webkit-scrollbar-thumb { background-color: var(--accent-color); border-radius: 10px; }

    .group {
      padding: 0 18px; cursor: pointer; background: transparent; border-right: 1px solid var(--border-color);
      line-height: var(--category-bar-height); white-space: nowrap; flex-shrink: 0; transition: background-color 0.2s;
    }
    .group:hover, .group.active { background: var(--accent-color); }

    /* KANAL Lƒ∞STESƒ∞ */
    .channel {
        display: flex; align-items: center; gap: 8px; background: var(--bg-tertiary);
        border-radius: 12px; padding: 10px; border: 1px solid var(--border-color);
        box-shadow: 0 4px 16px rgba(0,0,0,0.18), 0 1.5px 0.5px rgba(255,255,255,0.08) inset;
        transition: all 0.25s cubic-bezier(.4,2,.3,.7);
    }
    .channel-info { flex-grow: 1; cursor: pointer; display: flex; align-items: center; gap: 8px; min-width: 0; }
    .channel-info > div > div:first-child { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 900; }
    .channel:hover { background: var(--bg-hover); }
    .channel.active { border-color: var(--accent-color); background: var(--accent-color-darker); box-shadow: 0 8px 32px rgba(0,0,0,0.25), 0 0 12px var(--accent-color); }
    .channel img { width: 38px; height: 38px; object-fit: contain; flex-shrink: 0; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.18)) brightness(1.1); border-radius: 8px; }
    
    .fav-btn { font-size: 22px; cursor: pointer; padding: 5px; color: var(--text-secondary); transition: color 0.2s, transform 0.2s; flex-shrink: 0; }
    .fav-btn:hover { transform: scale(1.2); }
    .fav-btn.favorited { color: var(--favorite-color); }

    /* PLAYER BAR (SADECE KAYAN YAZI) */
    #playerContainer {
        position: fixed; bottom: 0; left: 0; width: 100%; height: var(--player-height); background: var(--bg-secondary);
        display: flex; z-index: 999; align-items: center; padding: 0 10px;
        border-top: 2px solid var(--border-color); 
        box-shadow: 0 -4px 24px rgba(0,0,0,0.18), 0 1.5px 0.5px rgba(255,255,255,0.08) inset;
    }
    
    .player-text { 
           width: 100%; /* Tam geni≈ülik */
           text-align: left; overflow: hidden; white-space: nowrap;
           background: linear-gradient(90deg, rgba(255,255,255,0.08) 0%, rgba(0,0,0,0.18) 100%);
           border-radius: 8px; border: 1.5px solid var(--accent-color);
           box-shadow: 0 2px 12px rgba(0,0,0,0.18) inset, 0 0 8px var(--accent-color) inset;
           height: 40px; display: flex; align-items: center;
    }
    .player-text .title { 
           display: inline-block; white-space: nowrap; will-change: transform; 
           animation: marquee-scroll 20s linear infinite; animation-play-state: paused; 
           font-size: 1.22em; font-weight: 900; color: var(--text-primary);
           text-shadow: 0 2px 8px rgba(0,0,0,0.45), 0 0 16px var(--accent-color), 0 0 2px #fff;
           padding-left: 10px;
    }
    #playerContainer.playing .player-text .title { animation-play-state: running; }
    .player-text .title span { display: inline-block; padding-right: 50px; }
    @keyframes marquee-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }


    /* Mobil Uyumluluƒüu */
    @media (max-width: 768px) {
        #channels { flex: 0 0 200px; }
        #main-logo-display { width: 130px; height: 130px; }
        /* Mobilde buton boyutlarƒ± */
        .mid-nav-btn { width: 60px; height: 60px; font-size: 26px; }
        #middle-controls-row { gap: 10px; }
        #side-controls-container { right: 5px; padding: 10px 5px; }
        .theme-swatch { width: 20px; height: 20px; }
        .zoom-btn { width: 28px; height: 28px; }
    }
  </style>
</head>
<body data-theme="steel">
  
  <div id="app">
    <div id="main">
      <div id="channels"></div>
      
      <div id="previewArea">
        
        <div id="side-controls-container">
            <button class="zoom-btn" id="zoom-in-btn" title="B√ºy√ºt">
                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            </button>
            
            <div id="theme-list"></div> 
            
            <button class="zoom-btn" id="zoom-out-btn" title="K√º√ß√ºlt">
                <svg viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2z"/></svg>
            </button>
        </div>

        <div id="previewPlaceholder">
          <h1> üìª Car Video Pro Radyo üìª</h1>
          <h2> üìû ƒ∞leti≈üim : Telegram : t.me/car_video_pro üìû</h2>
          <p>‚úîÔ∏è L√ºtfen bir kategori se√ßip radyo kanalƒ±na tƒ±klayƒ±nƒ±z. ‚úîÔ∏è</p>
        </div>
        
        <div id="visualizer-wrapper">
            <div class="analyzer-row top" id="analyzer-top"></div>
            
            <div id="middle-controls-row">
                <button class="mid-nav-btn" id="prev-btn" onclick="changeChannel(-1)">&#9664;</button>
                <img id="main-logo-display" src="" alt="Radyo Logosu">
                <button class="mid-nav-btn" id="next-btn" onclick="changeChannel(1)">&#9654;</button>
            </div>
            
            <div class="analyzer-row bottom" id="analyzer-bottom"></div>
        </div>
        
      </div>
    </div>
  </div>

  <div id="groups"></div>

  <div id="playerContainer">
      <div class="player-text">
        <div class="title" id="player-channel-name"></div>
      </div>
  </div>

  <audio id="audio-player"></audio>

  <script>
    const CATEGORIES = ["Favorilerim", "En √áok Dinlenenler", "Pop√ºler Radyolar", "T√ºrk√ße POP", "Arabesk Damar", "Haber", "Spor", "Dini", "Diƒüer"];
    const DEFAULT_SCROLL_TEXT = "Car Video Pro Eƒülencenin Adresi üìû ƒ∞leti≈üim : Telegram : t.me/car_video_pro üìû ";

    const G_UI = {
        groups: document.getElementById("groups"),
        channels: document.getElementById("channels"),
        preview: {
            area: document.getElementById("previewArea"),
            placeholder: document.getElementById("previewPlaceholder"),
            mainLogo: document.getElementById("main-logo-display"),
            analyzerTop: document.getElementById("analyzer-top"),
            analyzerBottom: document.getElementById("analyzer-bottom"),
        },
        player: { 
            container: document.getElementById("playerContainer"), 
            channelName: document.getElementById("player-channel-name")
        },
        themeList: document.getElementById("theme-list"),
        audioPlayer: document.getElementById("audio-player"),
        zoomInBtn: document.getElementById("zoom-in-btn"),
        zoomOutBtn: document.getElementById("zoom-out-btn"),
        htmlElement: document.documentElement
    };
    
    // TEMA Fonksiyonlarƒ±
    const themes = {
        'default': { name: 'Varsayƒ±lan', color: '#3366cc' }, 'forest': { name: 'Orman', color: '#4CAF50' }, 'royal': { name: 'Kraliyet', color: '#9C27B0' },
        'sunset': { name: 'G√ºn Batƒ±mƒ±', color: '#FF5722' }, 'steel': { name: '√áelik', color: '#757575' }, 'yellow': { name: 'Sarƒ±', color: '#FFD600' }
    };
    function applyTheme(themeName) {
        document.body.dataset.theme = themeName;
        localStorage.setItem('iptvTheme', themeName); 
        document.querySelectorAll('.theme-swatch').forEach(swatch => swatch.classList.toggle('active', swatch.dataset.theme === themeName));
    }
    function createThemeSelector() {
        G_UI.themeList.innerHTML = "";
        for (const [key, theme] of Object.entries(themes)) {
            const swatch = document.createElement('div');
            swatch.className = 'theme-swatch'; swatch.dataset.theme = key; swatch.title = theme.name;
            swatch.style.backgroundColor = theme.color; swatch.onclick = () => applyTheme(key);
            G_UI.themeList.appendChild(swatch);
        }
    }
    
    // Global Deƒüi≈ükenler
    let hls;
    let allChannelsMap = new Map(); 
    let currentChannelList = []; 
    let currentChannelIndex = -1; 
    let activeGroupName = ''; 
    
    // Zoom Deƒüi≈ükenleri
    const ZOOM_KEY = 'carRadioZoomLevel';
    const ZOOM_STEP = 0.05;
    const MIN_ZOOM = 0.7;
    const MAX_ZOOM = 1.3;
    let currentZoom = 1.0;

    // --- Zoom Fonksiyonlarƒ± ---
    const applyZoom = (zoomLevel) => { G_UI.htmlElement.style.zoom = zoomLevel; };
    const updateZoom = (newZoom) => {
        currentZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, newZoom));
        applyZoom(currentZoom);
        localStorage.setItem(ZOOM_KEY, currentZoom);
    };
    const loadSavedZoom = () => {
        const savedZoom = localStorage.getItem(ZOOM_KEY);
        if (savedZoom) {
            currentZoom = parseFloat(savedZoom);
            applyZoom(currentZoom);
        }
    };

    // --- Favori & Dinleme ---
    function getFavorites() { return JSON.parse(localStorage.getItem('favoriteRadios') || '[]'); }
    function saveFavorites(favs) { localStorage.setItem('favoriteRadios', JSON.stringify(favs)); }
    function getListenCounts() { return JSON.parse(localStorage.getItem('radioListenCounts') || '{}'); }
    function incrementListenCount(streamUrl) {
        if (!streamUrl) return;
        const counts = getListenCounts();
        counts[streamUrl] = (counts[streamUrl] || 0) + 1;
        localStorage.setItem('radioListenCounts', JSON.stringify(counts));
        if (activeGroupName === 'En √áok Dinlenenler') { listChannels(activeGroupName); }
    }
    function toggleFavorite(streamUrl, favButton) {
        let favorites = getFavorites();
        const index = favorites.indexOf(streamUrl);
        const wasEmpty = favorites.length === 0;
        const wasOnFavoritesTab = (activeGroupName === 'Favorilerim');
        if (index > -1) { favorites.splice(index, 1); favButton.classList.remove('favorited'); } 
        else { favorites.push(streamUrl); favButton.classList.add('favorited'); }
        saveFavorites(favorites);
        const isEmptyNow = favorites.length === 0;
        if (wasEmpty !== isEmptyNow) { listGroups(); }
        if (wasOnFavoritesTab) { listChannels('Favorilerim'); }
    }

    // --- Listeleme ---
    function listGroups() {
      const currentActiveGroup = document.querySelector('.group.active')?.textContent || CATEGORIES[0];
      G_UI.groups.innerHTML = ""; 
      let groupToActivate = null;
      const favoritesCount = getFavorites().length;
      const listenCounts = getListenCounts();
      const mostListenedCount = Object.keys(listenCounts).length;
      
      CATEGORIES.forEach((g) => {
        if (g === 'Favorilerim' && favoritesCount === 0) return;
        if (g === 'En √áok Dinlenenler' && mostListenedCount === 0) return;
        const el = document.createElement("div"); el.className = "group"; el.textContent = g;
        el.onclick = () => { 
            document.querySelectorAll(".group.active").forEach(e => e.classList.remove("active")); 
            el.classList.add("active"); activeGroupName = g; listChannels(g); 
        };
        G_UI.groups.appendChild(el); 
        if (g === currentActiveGroup) groupToActivate = el;
      });
      if (groupToActivate) { groupToActivate.click(); } else if (G_UI.groups.firstChild) { G_UI.groups.firstChild.click(); }
    }

    function listChannels(group) {
      G_UI.channels.innerHTML = "";
      const favorites = getFavorites();
      
      if (group === 'Favorilerim') {
        currentChannelList = favorites.map(url => allChannelsMap.get(url)).filter(Boolean); 
      } else if (group === 'En √áok Dinlenenler') {
        const listenCounts = getListenCounts();
        currentChannelList = Object.entries(listenCounts)
            .sort(([, countA], [, countB]) => countB - countA)
            .map(([url]) => allChannelsMap.get(url)).filter(Boolean).slice(0, 20);
      } else {
        const categoryId = CATEGORIES.indexOf(group);
        currentChannelList = Array.from(allChannelsMap.values()).filter(c => c.categoryId === categoryId);
      }
      
      currentChannelList.sort((a, b) => (a.name || "").localeCompare(b.name || ""));
      
      currentChannelList.forEach((c, idx) => {
        const isFavorited = favorites.includes(c.streamUrl);
        const el = document.createElement("div"); el.className = "channel";
        el.innerHTML = `
            <div class="channel-info">
                <img src="${c.logoUrl || ''}" onerror="this.style.display='none'" alt="logo">
                <div><div>${c.name}</div></div>
            </div>
            <span class="fav-btn ${isFavorited ? 'favorited' : ''}">‚òÖ</span>
        `;
        const channelInfo = el.querySelector('.channel-info'), favButton = el.querySelector('.fav-btn');
        channelInfo.onclick = () => { 
            document.querySelectorAll(".channel.active").forEach(ch => ch.classList.remove("active")); 
            el.classList.add("active"); playChannel(idx); 
        };
        favButton.onclick = (e) => { e.stopPropagation(); toggleFavorite(c.streamUrl, favButton); };
        G_UI.channels.appendChild(el);
      });
    }
    
    // --- Oynatƒ±cƒ± ---
    function stopStream(audioElement, hlsInstance) {
        audioElement.pause(); audioElement.removeAttribute("src");
        try { audioElement.load(); } catch (e) {}
        if (hlsInstance) { hlsInstance.destroy(); hls = null; }
        updatePlayerUI(false); 
    }

    async function playStream(audioElement, url) {
        stopStream(audioElement, hls); 
        const isHLS = url.includes('.m3u8');
        if (isHLS && Hls.isSupported()) { 
            hls = new Hls(); hls.loadSource(url); hls.attachMedia(audioElement); 
        } else { 
            hls = null; audioElement.src = url; 
        }
        audioElement.muted = false; audioElement.volume = 1.0;
        try { await audioElement.play(); } catch (err) { console.error("Otomatik oynatma engellendi:", err); updatePlayerUI(false); }
    }
    
    function playChannel(localIdx) {
        currentChannelIndex = localIdx; 
        const channel = currentChannelList[localIdx]; 
        if (!channel) return;
        incrementListenCount(channel.streamUrl);
        const scrollText = ` üéµ ${channel.name} üéµ - ${DEFAULT_SCROLL_TEXT}`;
        G_UI.player.channelName.innerHTML = `<span>${scrollText}</span><span>${scrollText}</span>`;
        G_UI.preview.mainLogo.src = channel.logoUrl || '';
        playStream(G_UI.audioPlayer, channel.streamUrl, true);
    }
    
    function updatePlayerUI(isPlaying) {
        G_UI.player.container.classList.toggle('playing', isPlaying);
        G_UI.preview.area.classList.toggle('is-playing', isPlaying);
    }
    
    function changeChannel(direction) {
        if (currentChannelList.length === 0 || currentChannelIndex < 0) return;
        const newIndex = (currentChannelIndex + direction + currentChannelList.length) % currentChannelList.length;
        const channelElements = G_UI.channels.querySelectorAll('.channel');
        if (channelElements[newIndex]) { 
            channelElements[newIndex].scrollIntoView({ behavior: 'smooth', block: 'center' }); 
            channelElements[newIndex].querySelector('.channel-info').click(); 
        }
    }

    // --- Veri Y√ºkleme ---
    async function fetchAndDisplayChannels() {
        try {
            const response = await fetch('./channels.txt?v=' + new Date().getTime()); 
            if (!response.ok) throw new Error(`HTTP hatasƒ±! Durum: ${response.status}`);
            
            const data = await response.text();
            const allChannels = data.trim().split('\n').map(line => {
                const [name, streamUrl, logoUrl, categoryIdStr] = line.split(',').map(item => item.trim());
                const categoryId = parseInt(categoryIdStr);
                return { name, streamUrl, logoUrl, categoryId };
            }).filter(ch => ch.name && ch.streamUrl && ch.logoUrl && !isNaN(ch.categoryId));

            allChannelsMap.clear();
            allChannels.forEach(channel => allChannelsMap.set(channel.streamUrl, channel));
            listGroups();
            
          } catch (error) {
            console.error('Kanal listesi y√ºklenemedi:', error);
            if (!navigator.onLine) {
                 G_UI.channels.innerHTML = '<p style="padding:10px; color:white;">Kanal listesi y√ºklenemedi. ƒ∞nternet baƒülantƒ±sƒ± yok.</p>';
             }
          }
    }
    
    // --- BA≈ûLATMA ---
    window.addEventListener("load", async () => {
      createThemeSelector(); 
      applyTheme(localStorage.getItem('iptvTheme') || 'steel');
      loadSavedZoom();
      
      // Ekolayzer Olu≈üturma
      [G_UI.preview.analyzerTop, G_UI.preview.analyzerBottom].forEach(analyzer => {
          for (let i = 0; i < 30; i++) { 
              const bar = document.createElement('div');
              bar.classList.add('analyzer-bar');
              bar.style.animationDelay = `${Math.random() * -1.5}s`;
              bar.style.animationDuration = `${Math.random() * 1 + 0.5}s`;
              analyzer.appendChild(bar);
          }
      });
      
      G_UI.audioPlayer.addEventListener('play', () => updatePlayerUI(true));
      G_UI.audioPlayer.addEventListener('pause', () => updatePlayerUI(false));
      G_UI.audioPlayer.addEventListener('ended', () => updatePlayerUI(false));
      
      G_UI.zoomInBtn.addEventListener('click', () => updateZoom(currentZoom + ZOOM_STEP));
      G_UI.zoomOutBtn.addEventListener('click', () => updateZoom(currentZoom - ZOOM_STEP));

      await fetchAndDisplayChannels();
      
      const defaultText = `Radyo Se√ßin - ${DEFAULT_SCROLL_TEXT}`;
      G_UI.player.channelName.innerHTML = `<span>${defaultText}</span><span>${defaultText}</span>`;
    });
  </script>
</body>
</html>